<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Restaurantes</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f6f6f6; margin:0; padding:20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        h1 { margin: 10px 0 20px; }
        .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(240px,1fr)); gap: 16px; }
        .card { background:#fff; border:1px solid #eee; border-radius:8px; padding:12px; cursor:pointer; transition: box-shadow .2s ease; }
        .card:hover { box-shadow: 0 6px 20px rgba(0,0,0,.08); }
        .title { font-weight: bold; margin: 6px 0; }
        .muted { color:#666; font-size: 13px; }
        img { width:100%; height:140px; object-fit:cover; border-radius:6px; background:#fafafa; }
        #erro { color: #b00020; margin-bottom:10px; }
        #busca { margin-bottom: 14px; width:100%; max-width: 420px; padding:8px 10px; border:1px solid #ddd; border-radius:6px; }
    </style>
    <script>
        async function fetchJson(url) {
            const res = await fetch(url);
            if (!res.ok) throw new Error('Falha ao carregar');
            const ct = res.headers.get('content-type') || '';
            if (ct.includes('application/json')) return res.json();
            const txt = await res.text();
            try { return JSON.parse(txt); } catch { throw new Error('Resposta inv√°lida'); }
        }

        function render(restaurantes) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            if (!Array.isArray(restaurantes) || restaurantes.length === 0) {
                grid.innerHTML = '<div class="muted">Nenhum restaurante encontrado</div>';
                return;
            }
            restaurantes.forEach(r => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => window.location.href = `./restaurantePerfil.html?id=${r.id}`;
                const imgSrc = r.bannerUrl || r.logoUrl || '';
                card.innerHTML = `
                    ${imgSrc ? `<img src="${imgSrc}" alt="${r.nome}" />` : '<div style="height:140px"></div>'}
                    <div class="title">${r.nome}</div>
                    <div class="muted">${[r.bairro, r.cidade].filter(Boolean).join(' - ')}</div>
                `;
                grid.appendChild(card);
            });
        }

        function filtrar(restaurantes, termo) {
            const t = (termo || '').toLowerCase();
            if (!t) return restaurantes;
            return restaurantes.filter(r =>
                (r.nome || '').toLowerCase().includes(t) ||
                (r.cidade || '').toLowerCase().includes(t) ||
                (r.bairro || '').toLowerCase().includes(t)
            );
        }

        async function init() {
            const erro = document.getElementById('erro');
            try {
                const restaurantes = await fetchJson('/restaurantes');
                render(restaurantes);
                const input = document.getElementById('busca');
                input.addEventListener('input', (e) => {
                    render(filtrar(restaurantes, e.target.value));
                });
            } catch (e) {
                erro.textContent = e.message;
            }
        }
        window.addEventListener('DOMContentLoaded', init);
    </script>
</head>
<body>
    <div class="container">
        <h1>Restaurantes</h1>
        <input id="busca" placeholder="Buscar por nome, bairro ou cidade" />
        <div id="erro"></div>
        <div id="grid" class="grid"></div>
    </div>
</body>
</html>

